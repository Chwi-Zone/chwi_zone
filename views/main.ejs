<!DOCTYPE HTML>
<html>

<head>
   <title>CHWI-ZONE</title>
   <meta charset="utf-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
   <!--<link rel="stylesheet" href="/css/main.css" />-->
   <link rel="stylesheet" href="../css/main.css" />
</head>

<body class="is-preload">

   <!-- Wrapper -->
   <div id="wrapper">
      <!-- Header -->
      <header id="header">
         <h1><a href="./index">Chwi-Zone</a></h1>
         <nav class="links">
            <ul>
               <li><a href="./mypage">마이페이지</a></li>
               <li><a href="./favorite">즐겨찾기</a></li>
            </ul>
         </nav>
         <nav class="main">
            <ul>
               <li class="search">
                  <a class="fa-search" href="#search">Search</a>
                  <form id="search" method="get" action="#">
                     <input type="text" name="query" placeholder="Search" />
                  </form>
               </li>
               <li class="menu">
                  <a class="fa-bars" href="#menu">Menu</a>
               </li>
            </ul>
         </nav>
      </header>
      <!-- Menu -->
      <section id="menu">
         <!-- Search -->
         <section>
            <form class="search" method="get" action="#">
               <input type="text" name="query" placeholder="Search" />
            </form>
         </section>
         <!-- Links -->
         <section>
            <ul class="links">
               <li>
                  <a href="./mypage">
                     <h3>마이페이지</h3>
                     <p>MyPage</p>
                  </a>
               </li>
               <li>
                  <a href="./favorite">
                     <h3>즐겨찾기</h3>
                     <p>Favorites</p>
                  </a>
               </li>
            </ul>
         </section>
         <!-- login action -->
         <section>
            <ul class="actions stacked">
               <li>
                  <a href="https://accounts.google.com/o/oauth2/v2/auth?scope=https://www.googleapis.com/auth/youtube&access_type=offline&include_granted_scopes=true&state=state_parameter_passthrough_value&redirect_uri=http://localhost:3000/account/googlesigncallback&response_type=code&client_id=323175054347-2opv5viepsbbh21foitrcit5qvfdh5is.apps.googleusercontent.com"
                     class="button large fit">
                     Log In
                  </a>
               </li>
            </ul>
         </section>
      </section>
      <!-- Sidebar -->
      <section id="sidebar">
         <section id="intro">
            <!--chwi-zone Logo-->
            <a href="./index" class="logo"><img src="../images/hana.png" alt="" /></a>
            <header>
               <h2>Chwi-Zone</h2>
               <p>당신의 취향 분석을 통한 주식 추천</p>
            </header>
         </section>
      </section>
      <div id = "email"><%=data%></div>
      <section id="companyList"></section>
      <!-- Footer -->
      <section id="footer">
      </section>
   </div>

   <!-- Scripts -->
   <!--css처럼 js도 상위 폴더로 올라가서 접근(public 폴더 안에 있는 거 다 바꿔줘야 함) -->
   <script src="../js/browser.min.js"></script>
   <script src="../js/breakpoints.min.js"></script>
   <script src="../js/util.js"></script>
   <script src="../js/main.js"></script>
   <script src="../js/jquery-3.2.1.min.js"></script>

   <script>
      //받아온 email 저장
      var email_address = document.getElementById("email").textContent;
      
      //취향 받아와서 회사 띄우기(sector_name보다 youtube_category로 하는게 좋을 듯)
      //main.js 코드다 company_list가 서버 초기화 안시키면 계속 받아오지기 때문에 company_list 값 받아올때마다 초기화하게 코드 작성 
      recommendStock();
      function recommendStock() {
         $.ajax({
            url: "/main/recommend",
            type: "GET",
            data: {
               email_address: email_address,
            },
            success: function (data) {
               console.log(data);
               for (var i = 0; i < data.length; i++) {
                  var dataElement = data[i];
                  $("#companyList").append(
                     '<h1>' + dataElement.sector_name + '</h1>')
                  for (var j = 0; j < dataElement.company_list.length; j++) {
                     var company_stocks_id = dataElement.company_list[j].stocks_id;
                     $("#companyList").append(
                        '<a href="../company?stocks_id=' +company_stocks_id+'" class="col-4">' +
                        '<span class="image fit" style="text-align:center">' +
                        dataElement.company_list[j].stocks_name +
                        '</span>' + '</a>');
                  }
                  $("#companyList").append('<br>');
               }
            },
         });
      }
   </script>
</body>

</html